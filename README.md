# newfun11

这是一个用于多智能体协同拆弹实验的二维房间环境服务器。服务器提供 FastAPI 接口，可供外部智能体或插件调用以模拟 5 个房间内的 5 个炸弹的拆除流程。

## 功能概述
- 随机生成连通的 5 个房间地图。
- 在地图中随机分布 5 颗炸弹：2 个单阶段、2 个双阶段、1 个三阶段。
- 三名特工（Alpha、Bravo、Charlie）分别携带红、绿、蓝三种剪线钳。
- 每回合三名特工可执行 `move`、`inspect`、`cut` 三类动作之一。
- 裁剪正确顺序的彩色导线即可完成拆弹，得分为阶段数 × 10 分。
- 回合上限 30 回合，或全部炸弹拆除，或重复动作导致僵局时结束。

## 安装与运行
1. 创建虚拟环境并安装依赖：
   ```bash
   pip install -r requirements.txt
   ```
2. 运行服务器：
   ```bash
   uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
   ```

服务器启动后，可通过 `http://localhost:8000/docs` 查看自动生成的接口文档。

## API 说明
### `POST /game/start`
创建新游戏，返回 `game_id` 和初始状态。

### `GET /game/{game_id}`
查询当前游戏状态，包括地图、炸弹、特工位置、得分等信息。

### `POST /game/{game_id}/act`
提交一回合内三名特工的动作。请求体示例：
```json
{
  "round_actions": [
    {"agent": "Alpha", "action": "move", "target": "Room-2"},
    {"agent": "Bravo", "action": "inspect"},
    {"agent": "Charlie", "action": "cut", "bomb_id": "B3", "color": "blue"}
  ]
}
```
返回最新状态和本回合的事件消息。若动作非法或游戏已结束，会返回 400 错误。

## 游戏规则细节
- 每个炸弹有若干阶段，每阶段需要特定颜色的剪线钳。
- 剪线顺序错误会触发 400 错误，呼叫端可据此调整策略。
- `inspect` 动作会让特工记住当前房间内所有未拆除炸弹的阶段颜色序列。
- 若连续三回合提交完全相同的动作集合，游戏会以“僵局”结束。
- 游戏结束后不能再提交动作，但可以继续查询最终状态。

如需扩展房间数量、炸弹类型或动作逻辑，可在 `app/game.py` 中调整对应的常量和逻辑实现。
